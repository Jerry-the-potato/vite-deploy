### **å¼•è¨€**
åœ¨æ˜¨å¤©çš„æ–‡ç« ä¸­ï¼Œæˆ‘å€‘ä»‹ç´¹äº† å¿«é€Ÿæ’åºï¼ˆQuick Sortï¼‰ æ¼”ç®—æ³•ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ç¨®åŸºæ–¼ åˆ†æ²»æ³• çš„æ’åºæ–¹æ³•ã€‚å¿«é€Ÿæ’åºé€éé¸å–ä¸€å€‹æ¨è»¸ï¼ˆpivotï¼‰ï¼Œå°‡æ•¸åˆ—åˆ†å‰²æˆå…©éƒ¨åˆ†ï¼Œä¸¦éè¿´åœ°å°æ¯å€‹éƒ¨åˆ†é€²è¡Œæ’åºã€‚å¦ä¸€æ–¹é¢ï¼Œä»Šå¤©æˆ‘å€‘è¦ä»‹ç´¹çš„å¦ä¸€ç¨®åˆ†æ²»æ³•æ’åºæ¼”ç®—æ³•â€”â€” åˆä½µæ’åºï¼ˆMerge Sortï¼‰ï¼Œå‰‡æ¡ç”¨äº†ä¸åŒçš„ç­–ç•¥ï¼Œé€éå…ˆåˆ†å‰²å†åˆä½µä¾†é”æˆæ’åºç›®çš„ã€‚

### åˆä½µæ’åº
![https://ithelp.ithome.com.tw/upload/images/20241004/20135197CDmWja37GM.png](https://ithelp.ithome.com.tw/upload/images/20241004/20135197CDmWja37GM.png)
> [ç·šä¸ŠæŸ¥çœ‹å‹•ç•«æ•ˆæœ](https://jerry-the-potato.github.io/vite-deploy/#SortAlgorithm)

æˆ‘å€‘é€šéä¸æ–·åˆ†å‰²é™£åˆ—ï¼Œç›´åˆ°ä¸èƒ½åˆ†å‰²ç‚ºæ­¢ï¼Œå†é€²è¡Œåˆä½µã€‚åˆä½µçš„æ™‚å€™æœƒå¾å…©å€‹é™£åˆ—çš„é–‹é ­å–å‡ºæœ€å°å€¼ï¼Œé‡è¤‡æ­¤æ­¥é©Ÿç›´åˆ°å…¶ä¸­ä¸€å€‹é™£åˆ—è¢«å®Œå…¨å–å‡ºï¼Œæœ€å¾Œå°‡å‰©ä¸‹çš„æ•¸å€¼æ·»åŠ åˆ°çµå°¾ã€‚
```javascript
function mergeSort(arr) {
    if (arr.length <= 1) return arr;
    const mid = Math.floor(arr.length / 2);
    const left = mergeSort(arr.slice(0, mid));
    const right = mergeSort(arr.slice(mid));
    return merge(left, right);
}

function merge(left, right) {
    let result = [];
    while (left.length && right.length) {
        if (left[0] < right[0]) result.push(left.shift());
        else result.push(right.shift());
    }
    return [...result, ...left, ...right];
}
```
é€™å€‹ç¯„ä¾‹é€šééè¿´åœ°å°‡æ•¸åˆ—åˆ†æˆå…©åŠé€²è¡Œæ’åºï¼Œæœ€å¾Œå†å°‡å·²æ’åºçš„éƒ¨åˆ†åˆä½µæˆä¸€å€‹æ•´é«”ã€‚é€™ç¨®æ–¹æ³•çš„æ™‚é–“è¤‡é›œåº¦ç‚º ğ‘‚(ğ‘› log ğ‘›)ï¼Œåœ¨è¨±å¤šæƒ…æ³ä¸‹ï¼Œåˆä½µæ’åºçš„æ€§èƒ½éå¸¸ç©©å®šã€‚ç„¶è€Œï¼Œæˆ‘å€‘é‡åˆ°å’Œå¿«é€Ÿæ’åºç›¸åŒçš„å•é¡Œï¼Œé€™å€‹æ¶æ§‹è¼ƒé›£æ¤å…¥è¦–è¦ºåŒ–çš„ç¨‹å¼ç¢¼ã€‚

### è¿­ä»£æ–¹ç¨‹å¼
é€™ä¸€ç‰ˆæœ¬ä½¿ç”¨æ¨¡æ“¬éè¿´çš„æ–¹å¼ï¼Œé€é stack ä¿å­˜è¦è™•ç†çš„å­é™£åˆ—ç¯„åœï¼Œé¿å…äº†éè¿´èª¿ç”¨ï¼Œå°è¨˜æ†¶é«”å‹å–„ã€‚èˆ‡éè¿´ç‰ˆæœ¬ä¸åŒï¼Œæˆ‘å€‘å°‡æ‰‹å‹•ç®¡ç†æ¯å€‹éšæ®µçš„åˆä½µæ­¥é©Ÿï¼Œé€™ä½¿å¾—éç¨‹æ›´åŠ å…·é«”ä¸”å¯æ§åˆ¶ã€‚

ä»¥ä¸‹æ˜¯åŸºæ–¼è¿­ä»£çš„ç¨‹å¼çµæ§‹ï¼Œåˆ†ç‚ºå¤šå€‹éšæ®µé€²è¡Œåˆä½µæ’åºï¼Œæ¯æ¬¡åŸ·è¡Œä½æ–¼ stack é™£åˆ—æœ€ä¸Šå±¤çš„ä»»å‹™ï¼Œä¸¦æ±ºå®šä½•æ™‚ pop æˆ– push ä»¥ç®¡ç†åˆä½µæ­¥é©Ÿï¼š
```javascript
class SortAlgorithm{
    constructor(){
        this.secondColumns = [];
    }
    mergeSortSetting(columns){
        const heights = columns.map((column)=>{return column.height});
        this.height = Math.max(...heights);
        this.stack = [[], []];
        this.stack[0][0] = {'left': 0, 'right': columns.length - 1};
        this.mergePhase = "0.Split";
        this.i = 0;
        this.j = 0;
    }
    mergeSort(columns) {
        const len0 = this.stack[0].length;
        const len1 = this.stack[1].length;
        const {min, mid, max} = this.stack[1][len1 - 1] ? this.stack[1][len1 - 1] : {};
        const i = this.i;
        const j = mid - min + this.j;
        const col = this.secondColumns.slice(min, max + 1);
        const frame = 60;
        // const frame = Math.floor((max - j + mid - i)/(len/256));
        switch(this.mergePhase){
            case "0.Split":
            case "1.Copy":
            case "2.Merge":
            case "3.MergeLeft":
            case "4.MergeRight":
            default :
        }
    }
}
```
* stackï¼šç‚ºæ±‚æ­¥é©Ÿæ¸…æ™°ï¼Œå°‡åˆ†å‰²å’Œåˆä½µåˆ†é–‹å­˜æ”¾ã€‚len0 è¡¨ç¤ºå¾…åˆ†å‰²å †ç–Šé•·åº¦ã€len1 è¡¨ç¤ºå¾…åˆä½µå †ç–Šé•·åº¦ã€‚
* mergePhaseï¼šç”¨æ–¼æ§åˆ¶åˆä½µæ’åºçš„ä¸åŒéšæ®µï¼Œå¾ã€Œ0.Splitã€é–‹å§‹ã€‚
* {min, mid, max}ï¼šç”¨ä¾†è¡¨ç¤ºå¾…åˆä½µé™£åˆ—çš„å·¦å³ç´¢å¼•ç¯„åœã€‚
* i å’Œ jï¼šç”¨æ–¼è¿½è¸ªåˆä½µéç¨‹ä¸­å·¦å³é™£åˆ—çš„ç•¶å‰ç´¢å¼•ä½ç½®ã€‚
* colï¼šåœ¨åˆä½µéšæ®µï¼‘ï½ï¼”æ™‚ï¼Œå–ç”¨éœ€è¦é€²è¡Œåˆä½µçš„ç‰‡æ®µ

#### éšæ®µï¼ï¼šåˆ†å‰²é™£åˆ—
é€™å€‹éšæ®µæœƒé‡è¤‡é€²è¡Œï¼Œæ¨™è¨˜ä¸¦æ¨é€æ‰€æœ‰åˆ†å‰²çš„ç´¢å¼•å€¼åˆ° stack[1]ï¼Œç›´åˆ°ä¸èƒ½å†åˆ†å‰²ç‚ºæ­¢ã€‚ç‚ºæ±‚è¦–è¦ºè¡æ“Šï¼Œæ­¤æ™‚æˆ‘å€‘è¤‡è£½ä¸€æ•´ä»½çš„é•·æ¢åœ–ï¼Œé€éå‹•ç•«è·¯å¾‘çš„è¨­å®šï¼Œå°‡å…¶ç§»å‹•åˆ°åŸåœ–å½¢çš„æ­£ä¸Šæ–¹ã€‚
```javascript
case "0.Split":
if(len0 == 0){
    this.mergePhase = "1.Copy";
    this.timesEveryFrame = 1;
    this.secondColumns = JSON.parse(JSON.stringify(columns.slice(0, columns.length + 1)));
    this.secondColumns.forEach((column) => {
        column.path = new Path(column.x, column.y);
        column.path.NewTarget(column.x, column.y - this.height, 20);
        column.width/=3;
    })
    return;
}
const { left, right } = this.stack[0][len0 - 1];
const middle = Math.ceil((left + right) / 2);
this.stack[0].pop();
if(left != right){
    this.stack[0].push({'left': left, 'right': middle - 1});
    this.stack[0].push({'left': middle, 'right': right});
    this.stack[1].push({'min': left, 'mid': middle, 'max': right});
}
break;
```
* JSONï¼šåœ¨è¤‡è£½ columns ç‰©ä»¶çš„æ™‚å€™ï¼Œæˆ‘å€‘åˆ©ç”¨ JSON æ ¼å¼æŠŠå®ƒè®Šæˆæ–‡æœ¬åœ¨è½‰æ›å›ç‰©ä»¶ï¼Œå°±å¯ä»¥è¤‡è£½æ¯å€‹éµå€¼çš„åŒæ™‚ï¼Œåˆé¿å…ä¿®æ”¹åˆ°åŸå§‹ç‰©ä»¶ã€‚
* ä½†è¦æ³¨æ„åˆ°ï¼šå›é¡§ç²’å­ç³»çµ±ä¸­ï¼Œé•·æ¢åœ–æœ¬èº«é‚„åŒ…å«äº†å‹•ç•«é¡ Path ç”¨ä»¥å¯¦ç¾å‹•ç•«ï¼Œé€™æ˜¯ JSON æ²’è¾¦æ³•æ‹·è²åˆ°çš„åœ°æ–¹ï¼Œæ‰€ä»¥æˆ‘å€‘æ‰å¿…é ˆå‰µå»ºæ–°çš„å‹•ç•«ç‰©ä»¶ã€‚
```javascript
class ParticleSystem{
    createColumn(x, y, width, height){
        const path = new Path(x, y);
        const column = {x, y, width, height, path};
        return column;
    }
}
```

#### éšæ®µï¼‘ï¼šæ‹·è²é™£åˆ—
é‡å°è¦åˆä½µçš„ç‰‡æ®µï¼Œæ‹·è²é•·æ¢åœ–çš„é«˜åº¦ï¼ˆæ•¸å€¼ï¼‰ï¼Œä¸¦è¨­ç½®äº›å¾®ä¸åŒçš„å¯¬åº¦ï¼Œä»¥ç¤ºå€åˆ¥ã€‚é€™å€‹æ­¥é©Ÿæ‰æ˜¯çœŸæ­£çš„æ‹·è²ï¼Œä½†æ˜¯å®¹æ˜“ç™¼ç”Ÿæ‹·è²å‹•ç•«é‚„æ²’å®Œæˆï¼Œå°±å·²ç¶“åˆä½µå®Œæˆã€‚é›–ç„¶ä¸å½±éŸ¿å‹•ç•«æµæš¢æ€§ï¼Œä½†è¦–è¦ºåŒ–éç¨‹ä¸å¤ æ¸…æ™°ã€‚å› æ­¤æ‰æœƒåœ¨ä¸Šå€‹éšæ®µé€²è¡Œçµ±ä¸€çš„å‰ç½®è™•ç†ï¼Œä¸»è¦æ˜¯è¦–è¦ºåŒ–çš„è€ƒé‡ã€‚
```javascript
case "1.Copy":
if(len1 == 0){
    return true;
}
col.forEach((column, index) => {
    column.height = columns[min + index].height;
    column.width = columns[min + index].width/2;
    column.path.NewTarget(column.x, column.y - this.height, 20);
})
this.mergePhase = "2.Merge";
break;
```
* len1ï¼šç•¶éœ€è¦åˆä½µçš„å †ç–Šæ¸…ç©ºï¼Œå°±æœƒçµæŸæ¼”ç®—æ³•ã€‚
* colï¼šç”±æ–¼è©²é™£åˆ—æ˜¯ç”¨ slice æ–¹æ³•å–å¾—ï¼Œå®ƒå¯ä»¥ç”¨ä¾†åŒæ­¥ä¿®æ”¹ this.secondColumns çš„è³‡æ–™
#### éšæ®µï¼’ï¼šåˆä½µ
é€™éƒ¨åˆ†æ‰é–‹å§‹å¯¦éš›çš„åˆä½µéç¨‹ã€‚æ¯æ¬¡æ¯”è¼ƒ left å’Œ right çš„å…ƒç´ ï¼Œå°‡è¼ƒå°çš„æ•¸å€¼æ”¾åˆ°åˆä½µé™£åˆ—ä¸­ã€‚é€™å€‹éç¨‹æœƒæŒçºŒåˆ°ä¸€å€‹å­é™£åˆ—è¢«å®Œå…¨å–å‡ºã€‚
```javascript
case "2.Merge":
if(col[i].height > col[j].height){
    const a = col[j];
    const b = columns[min + this.i + this.j];
    SortAlgorithm.swapColumn(a, b, frame);
    a.height = 0;
    this.j++;
    if(this.j > max - mid){
        this.mergePhase = "3.MergeLeft";
    }
}
else{
    const a = col[i];
    const b = columns[min + this.i + this.j];
    SortAlgorithm.swapColumn(a, b, frame);
    a.height = 0;
    this.i++;
    if(this.i > mid - 1 - min){
        this.mergePhase = "4.MergeRight";
    }
}
break;
```
* i, j è¡¨ç¤ºå·¦å³å…ƒç´ ä½æ–¼æ‹·è²é™£åˆ—çš„ç´¢å¼•å€¼
* min + this.i + this.j å‰‡è¡¨ç¤ºåœ¨åŸå§‹é™£åˆ—çš„ç´¢å¼•å€¼
* äº¤æ›é•·æ¢åœ–å¾Œï¼Œé€éæŠŠæ‹·è²é™£åˆ—çš„é«˜åº¦è¨­ç½®ç‚º 0ï¼Œè£½é€ å‡ºè¢«å–ä»£çš„è¦–è¦ºç•«é¢
#### éšæ®µï¼“ï¼šåˆä½µå·¦å´
ç•¶å³åŠéƒ¨åˆ†å·²ç¶“åˆä½µå®Œç•¢ï¼Œè™•ç†å·¦åŠéƒ¨åˆ†çš„å‰©é¤˜å…ƒç´ ï¼Œé‡è¤‡å–ä»£åŸå§‹é™£åˆ—ï¼Œç›´åˆ°çµæŸï¼Œå°‡å †ç–Šé‡‹æ”¾ï¼Œä¸¦å›åˆ°æ‹·è²éšæ®µã€‚
```javascript
case "3.MergeLeft":
if(i > mid - 1 - min){
    this.i = 0;
    this.j = 0;
    this.stack[1].pop();
    this.mergePhase = "1.Copy";
}
else{
    const a = col[i];
    const b = columns[min + this.i + this.j];
    SortAlgorithm.swapColumn(a, b, frame);
    a.height = 0;
    this.i++;
}
break;
```
#### éšæ®µï¼”ï¼šåˆä½µå³å´
å’Œéšæ®µï¼“ç›¸ä¼¼ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œåˆ†å‰²å·¦å³å´çš„ç´¢å¼•å€¼åˆ†åˆ¥æ˜¯ mid - 1 å’Œ midï¼Œå› æ­¤å…©è€…æ¯”è¼ƒçš„ç´¢å¼•å€¼å¤§å°æœ‰æ‰€å€åˆ¥ã€‚
```javascript
case "4.MergeRight":
if(j > max - min){
    this.i = 0;
    this.j = 0;
    this.stack[1].pop();
    this.mergePhase = "1.Copy";
}
else{
    const a = col[j];
    const b = columns[min + this.i + this.j];
    SortAlgorithm.swapColumn(a, b, frame);
    a.height = 0;
    this.j++;
}
break;
```

### è¿­ä»£å™¨å’Œç”Ÿæˆå™¨
ç¾åœ¨ï¼Œè®“æˆ‘å€‘åˆ©ç”¨ è¿­ä»£ç”Ÿæˆå™¨ (Generator Function) ä¾†å¯¦ç¾éè¿´ï¼Œçµæ§‹ä¸Šå’Œæ˜¨å¤©çš„å¿«é€Ÿæ’åºç›¸ä¼¼ã€‚åœ¨é€™è£¡æˆ‘å€‘æœƒå…ˆå°‡æ•¸æ“šé€²è¡Œåˆ†å‰²ï¼Œæœ€å¾Œæ‰åˆä½µï¼Œé€™æ¨£ä¸ä½†èƒ½ä¿æŒç¨‹å¼çµæ§‹ç°¡æ½”ï¼ŒåŒæ™‚ä¹Ÿä¾¿æ–¼å‹•ç•«å±•ç¤ºå’Œç•°æ­¥æ“ä½œã€‚

```javascript
class SortAlgorithmIterable{
    * mergeSortMaker(columns, left = 0, right = columns.length - 1) {
        if (left >= right) return;
        const mid = Math.ceil((left + right) / 2);
        yield* this.mergeSortMaker(columns, left, mid - 1);
        yield* this.mergeSortMaker(columns, mid, right);
        yield* this.mergeMaker(columns, left, mid, right);
        if(left == 0 && right == columns.length - 1) yield true;
    }
}
```
åˆä½µçš„éƒ¨åˆ†æˆ‘å€‘æ¡ç”¨ç›¸åŒçš„æ–¹æ³•ï¼Œæ­¤æ™‚æˆ‘å€‘å¯ä»¥æ”¾å…¥å®Œæ•´çš„æ¼”ç®—æ³•è€Œä¸éœ€è¦ç‹€æ…‹ç®¡ç†ï¼Œé€é yield å°±èƒ½æ§åˆ¶æ¯å€‹æ­¥é©Ÿçš„åŸ·è¡Œï¼š
```javascript
class SortAlgorithmIterable{
    * mergeMaker(columns, left, mid, right) {
        // éšæ®µï¼‘ï¼šæ‹·è²é™£åˆ—
        this.secondColumns = JSON.parse(JSON.stringify(columns.slice(left, right + 1)));
        const heights = this.secondColumns.map((column)=>{return column.height});
        const max = Math.max(...heights);
        // ç‚ºæ¯å€‹ column æ·»åŠ  path 
        this.secondColumns.forEach((column) => {
            column.path = new Path(column.x, column.y);
            column.path.NewTarget(column.x, column.y - max, 20);
            column.width /= 2;
        });

        let i = 0;
        let j = mid - left + 1;
        let k = left;

        // éšæ®µï¼’ï¼šåˆä½µ
        while (i <= mid - 1 - left && j <= right - left) {
            yield false;
            if (this.secondColumns[i].height <= this.secondColumns[j].height) {
                var b = this.secondColumns[i];
                i++;
            } else {
                var b = this.secondColumns[j];
                j++;
            }
            const a = columns[k];
            SortAlgorithm.swapColumn(a, b, 30);
            b.height = 0;
            k++;
        }

        // éšæ®µï¼“ï¼šåˆä½µå·¦å´
        while (i <= mid - 1 - left) {
            yield false;
            const a = columns[k];
            const b = this.secondColumns[i];
            SortAlgorithm.swapColumn(a, b, 30);
            b.height = 0;
            i++;
            k++;
        }

        // éšæ®µï¼”ï¼šåˆä½µå³å´
        while (j <= right - left) {
            yield false;
            const a = columns[k];
            const b = this.secondColumns[j];
            SortAlgorithm.swapColumn(a, b, 30);
            b.height = 0;
            j++;
            k++;
        }
    }
}
```
çµåˆä»¥ä¸Šä¾‹å­ï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ°ç‚ºäº†å¯¦ç¾è¦–è¦ºåŒ–å’Œé€æ ¼å‹•ç•«ï¼Œåˆä½µæ’åºçš„ç”Ÿæˆå™¨ç‰ˆæœ¬ä¸¦æ²’è¾¦æ³•å‘å‰å¹¾ç¨®æ’åºä¸€æ¨£ç°¡æ½”ã€‚ç„¶è€Œï¼Œä»æ¯”æ‰‹å‹•ç®¡ç†å †ç–Šæ›´å…·æœ‰å¯è®€æ€§ã€‚é€™æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†åŸå› æ˜¯åˆ†æ²»æ³•æœ¬èº«ä¸éœ€è¦è¤‡é›œçš„ç‹€æ…‹ç®¡ç†ï¼Œå®ƒåˆ©ç”¨éè¿´å’Œç·šæ€§æ“ä½œä¾†å®Œæˆï¼Œå› æ­¤éå¸¸é©åˆç”¨ç”Ÿæˆå™¨è£½ä½œé€æ ¼å‹•ç•«ã€‚

### **çµè«–**
åœ¨å¯¦ä½œä¸­ï¼Œç”Ÿæˆå™¨é€é yield ä¾†æ§åˆ¶æ¯å€‹æ­¥é©Ÿçš„åŸ·è¡Œï¼Œä½¿å¾—å‹•ç•«æ•ˆæœçš„å±•ç¤ºæ›´åŠ æµæš¢ã€‚é€™æ¨£çš„çµæ§‹ä¸åƒ…ä¿æŒäº†ç¨‹å¼ç¢¼çš„æ•´æ½”æ€§ï¼Œé‚„å¢å¼·äº†ç¨‹å¼çš„å¯ç†è§£æ€§ï¼Œè®“æˆ‘å€‘èƒ½å¤ æ›´å°ˆæ³¨æ–¼æ¼”ç®—æ³•çš„é‚è¼¯è€Œéç‹€æ…‹ç®¡ç†çš„ç´°ç¯€ã€‚

åœ¨æ€è€ƒéè¿´çš„æ ¸å¿ƒæ¦‚å¿µæ™‚ï¼Œæˆ‘å€‘ä¹Ÿéœ€è¦è€ƒæ…®æ˜¯å¦çœŸçš„æœ‰å¿…è¦æ‰‹å‹•ç®¡ç†å †ç–Šã€‚åœ¨è¨±å¤šæƒ…æ³ä¸‹ï¼Œåˆ©ç”¨ç”Ÿæˆå™¨ä¾†ç°¡åŒ–æµç¨‹ï¼Œèƒ½æœ‰æ•ˆé™ä½è¤‡é›œåº¦ï¼Œä¸¦ä½¿ç¨‹å¼ç¢¼çš„ç¶­è­·å’Œæ“´å±•è®Šå¾—æ›´åŠ å®¹æ˜“ã€‚