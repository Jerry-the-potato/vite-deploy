### 為什麼要錄影
在互動性高的應用程式中，讓使用者可以自由紀錄畫面，是必備的元素之一。這不僅提供了用戶便捷的錄影功能，也讓開發者可以輕鬆製作展示影片。無論是創建教學影片還是捕捉用戶操作、上傳到Youtube，錄影功能都能大大提升應用的靈活性和實用性。這篇文章將展示如何在 React 和 Vue 應用中實現一個簡單而功能強大的錄影按鈕。

### 功能概述
我們將實現一個 RecordBtn 元件，這個元件提供了開始和停止錄影的功能。該按鈕會在點擊時切換錄影狀態，並能捕捉畫面和音訊流。錄影的結果將被保存為 MP4 格式的影片檔案，供用戶下載和查看。

核心功能實現：
1. 設置和管理錄影狀態：我們使用 React 的 useState 來跟蹤錄影狀態，並根據狀態更新按鈕文字。
2. 捕捉畫面和音訊流：錄影時，我們從 <canvas> 捕捉畫面流，如果提供了音訊來源，則同時捕捉音訊流。
3. 錄影資料的處理與下載：錄影結束後，我們將錄影資料組合成影片檔案，並觸發下載。

在使用這個元件時，把想要錄影的 canvas 和 audio 對象，作為參數傳入：
```
const canvas = useRef(null);
const audio = useRef(null);

return (
    <section className="section" id={uniqueID}>
        <canvas ref={canvas} width={min * ratio} height={ratio * min * ratio}></canvas>
        {/* ...... */}
        <RecordBtn canvas={canvas} audio={audio}></RecordBtn>
    </section>
)
```

### 初始化
```
import downloadMedia from '../js/downloadMedia';

const media = {};
```
* downloadMedia 是一個自定義的函數，用於處理錄影結束後的數據下載。
* media 物件，用來儲存錄影所需的媒體流和錄影器實例。

### 捕捉串流
這個方法其實也適用於 audio 或 video 元素，可以看情況拓展，讓它不只串流canvas的內容。
```
const chunks = [];
media.stream = canvas.current.captureStream(60); // fps
```
* chunks 是一個數組，用來儲存錄影過程中產生的數據片段。
* media.stream 是從畫布捕捉到的媒體流，captureStream 方法的參數是每秒幀數（fps），這裡設置為 60 fps。

### 將音訊片段加入 media.stream
我們嘗試裁剪原本的串流，只保留視訊，這會導致原本的音訊丟失，不過，canvas本來就沒有音頻，所以可以放心的創建一個新的 MediaStream。
```
if(audio){
    media.audio = audio.current;
    media.audio.play();
    media.audioStream = media.audio.captureStream();
    media.stream = new MediaStream([
        ...media.stream.getVideoTracks(),
        ...media.audioStream.getAudioTracks()
    ]);
}
```
* 如果提供了 audio，則從音頻元素捕捉音頻流，並開始播放。
* media.audioStream 是從音頻元素捕捉到的音頻，並將其與畫布的視訊合併成一個新的媒體流 media.stream。

#### ???
```
media.recorder = new MediaRecorder(media.stream, { mimeType: "video/mp4; codecs=vp9" });
media.recorder.ondataavailable = (evt) => { chunks.push(evt.data); };
media.recorder.onstop = () => { downloadMedia(chunks); };
media.recorder.start(1000);
```
* media.recorder 創建了一個新的 MediaRecorder 實例，並指定了 mimeType 為 "video/mp4; codecs=vp9"。
* ondataavailable 事件處理器會在錄影過程中每當有新的數據片段可用時被調用，將這些數據片段推入 chunks 陣列。
* onstop 事件處理器會在錄影停止時被調用，調用 downloadMedia 函數來處理錄影數據的下載。
* start(1000) 方法啟動錄影，每 1000 毫秒收集一次數據。

### 下載
還記得我們開頭用了一個 downloadMedia 函式嗎？讓我們把它完成：


### 結語
這樣的設計讓用戶可以方便地錄製畫面和音訊，並將錄製的內容保存到本地，進一步增強了應用程式的互動性和展示效果。

如果感興趣，可以參考 Github 上的原始碼：
[RecordBtn.jsx](https://github.com/Jerry-the-potato/vite-deploy/blob/main/src/component/RecordBtn.jsx)
[RecordBtn.vue](https://github.com/Jerry-the-potato/vite-vue/blob/main/src/components/RecordBtn.vue)

這次也留給大家一個問題：你會如何擴展這個錄影功能，例如加入更多的錄影選項或提高錄影品質？